{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://edugpt.example.com/schemas/learner_profile.schema.json",
  "title": "Learner Profile Schema",
  "description": "Comprehensive learner profile with cognitive traits, preferences, progress tracking, and performance analytics",
  "type": "object",
  "additionalProperties": false,
  "required": ["meta", "learner_id", "personal_info", "cognitive_profile", "learning_preferences", "progress", "performance_analytics"],

  "$defs": {
    "learner_id": {
      "type": "string",
      "pattern": "^learner-[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
      "description": "Unique learner identifier (UUID v4 format)"
    },
    "module_id": {
      "type": "string",
      "pattern": "^m[0-9]{2}-[a-z0-9-]+$",
      "description": "Module identifier matching syllabus schema"
    },
    "iso_datetime": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 datetime"
    },
    "percentage": {
      "type": "number",
      "minimum": 0,
      "maximum": 100,
      "multipleOf": 0.01
    },
    "mastery_level": {
      "type": "string",
      "enum": ["novice", "beginner", "intermediate", "advanced", "expert"],
      "description": "Five-level mastery classification"
    },
    "difficulty_level": {
      "type": "string",
      "enum": ["very_easy", "easy", "medium", "hard", "very_hard"],
      "description": "Five-level difficulty classification"
    }
  },

  "properties": {
    "meta": {
      "type": "object",
      "additionalProperties": false,
      "required": ["schema_version", "created_at", "last_updated"],
      "properties": {
        "schema_version": {
          "type": "integer",
          "const": 1,
          "description": "Schema version for forward compatibility"
        },
        "created_at": {
          "$ref": "#/$defs/iso_datetime",
          "readOnly": true
        },
        "last_updated": {
          "$ref": "#/$defs/iso_datetime",
          "readOnly": true
        }
      }
    },

    "learner_id": {
      "$ref": "#/$defs/learner_id"
    },

    "personal_info": {
      "type": "object",
      "additionalProperties": false,
      "required": ["name"],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 200
        },
        "email": {
          "oneOf": [
            {
              "type": "string",
              "format": "email",
              "maxLength": 320
            },
            {
              "type": "null"
            }
          ],
          "description": "Optional email address"
        },
        "goals": {
          "type": "array",
          "maxItems": 20,
          "items": {
            "type": "string",
            "minLength": 1,
            "maxLength": 200
          },
          "description": "Learning goals",
          "default": []
        },
        "interests": {
          "type": "array",
          "maxItems": 50,
          "items": {
            "type": "string",
            "minLength": 1,
            "maxLength": 100
          },
          "description": "Areas of interest",
          "default": []
        },
        "prior_knowledge": {
          "type": "object",
          "additionalProperties": {
            "type": "string",
            "enum": ["beginner", "intermediate", "advanced", "expert"]
          },
          "maxProperties": 50,
          "description": "Prior knowledge by topic with proficiency level",
          "default": {}
        },
        "age_group": {
          "type": "string",
          "enum": ["child", "teen", "young_adult", "adult", "senior"]
        },
        "timezone": {
          "type": "string",
          "pattern": "^[A-Za-z_]+/[A-Za-z_]+$",
          "description": "IANA timezone (e.g., America/New_York)"
        }
      }
    },

    "cognitive_profile": {
      "type": "object",
      "additionalProperties": false,
      "required": ["learning_style", "pace"],
      "properties": {
        "learning_style": {
          "type": "array",
          "minItems": 1,
          "maxItems": 4,
          "uniqueItems": true,
          "items": {
            "type": "string",
            "enum": ["visual", "auditory", "reading_writing", "kinesthetic"]
          },
          "description": "VARK learning styles (ordered by preference)"
        },
        "pace": {
          "type": "string",
          "enum": ["slow", "moderate", "fast", "self_paced"],
          "description": "Preferred learning pace"
        },
        "attention_span_minutes": {
          "type": "integer",
          "minimum": 5,
          "maximum": 180,
          "description": "Typical focused attention duration"
        },
        "working_memory_capacity": {
          "type": "string",
          "enum": ["low", "average", "high"],
          "description": "Ability to hold information temporarily"
        },
        "prior_knowledge_domains": {
          "type": "array",
          "maxItems": 50,
          "items": {
            "type": "string",
            "minLength": 2,
            "maxLength": 100
          },
          "description": "Previously mastered subject areas"
        }
      }
    },

    "learning_preferences": {
      "type": "object",
      "additionalProperties": false,
      "required": ["difficulty_preference"],
      "properties": {
        "difficulty_preference": {
          "$ref": "#/$defs/difficulty_level",
          "description": "Preferred starting difficulty"
        },
        "feedback_frequency": {
          "type": "string",
          "enum": ["immediate", "per_section", "per_module", "on_demand"],
          "description": "When to receive performance feedback"
        },
        "hints_enabled": {
          "type": "boolean",
          "default": true,
          "description": "Allow hints during assessments"
        },
        "gamification_enabled": {
          "type": "boolean",
          "default": false,
          "description": "Enable badges, points, streaks"
        },
        "preferred_session_length_minutes": {
          "type": "integer",
          "minimum": 10,
          "maximum": 240,
          "description": "Ideal study session duration"
        },
        "accessibility_needs": {
          "type": "array",
          "maxItems": 20,
          "items": {
            "type": "string",
            "enum": [
              "screen_reader",
              "high_contrast",
              "large_text",
              "captions",
              "dyslexia_font",
              "reduced_motion",
              "keyboard_only"
            ]
          },
          "uniqueItems": true
        }
      }
    },

    "progress": {
      "type": "object",
      "additionalProperties": false,
      "required": ["enrolled_syllabus_id", "current_module_id", "modules_completed", "overall_completion_percent"],
      "properties": {
        "enrolled_syllabus_id": {
          "oneOf": [
            {"type": "string", "minLength": 1},
            {"type": "null"}
          ],
          "description": "Reference to active syllabus (null if not enrolled)"
        },
        "current_module_id": {
          "oneOf": [
            {"$ref": "#/$defs/module_id"},
            {"type": "null"}
          ],
          "description": "Currently active module (null if not started or finished)"
        },
        "modules_completed": {
          "type": "array",
          "maxItems": 200,
          "items": {
            "$ref": "#/$defs/module_id"
          },
          "uniqueItems": true,
          "description": "List of completed module IDs"
        },
        "overall_completion_percent": {
          "$ref": "#/$defs/percentage",
          "readOnly": true,
          "description": "Computed completion percentage"
        },
        "module_progress": {
          "type": "object",
          "additionalProperties": false,
          "patternProperties": {
            "^m[0-9]{2}-[a-z0-9-]+$": {
              "type": "object",
              "additionalProperties": false,
              "required": ["status", "mastery_level", "started_at"],
              "properties": {
                "status": {
                  "type": "string",
                  "enum": ["not_started", "in_progress", "completed", "mastered"],
                  "description": "Module completion status"
                },
                "mastery_level": {
                  "$ref": "#/$defs/mastery_level"
                },
                "started_at": {
                  "$ref": "#/$defs/iso_datetime"
                },
                "completed_at": {
                  "$ref": "#/$defs/iso_datetime"
                },
                "time_spent_minutes": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "Total time spent on module"
                },
                "attempts": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "Number of assessment attempts"
                },
                "best_score": {
                  "$ref": "#/$defs/percentage"
                }
              }
            }
          },
          "description": "Per-module progress details"
        },
        "learning_streak_days": {
          "type": "integer",
          "minimum": 0,
          "readOnly": true,
          "description": "Consecutive days with learning activity"
        },
        "total_study_time_minutes": {
          "type": "integer",
          "minimum": 0,
          "readOnly": true,
          "description": "Cumulative study time"
        }
      }
    },

    "performance_analytics": {
      "type": "object",
      "additionalProperties": false,
      "required": ["overall_mastery_level", "strengths", "weaknesses"],
      "properties": {
        "overall_mastery_level": {
          "$ref": "#/$defs/mastery_level",
          "readOnly": true
        },
        "average_score": {
          "$ref": "#/$defs/percentage",
          "readOnly": true,
          "description": "Mean score across all assessments"
        },
        "strengths": {
          "type": "array",
          "maxItems": 20,
          "items": {
            "type": "string",
            "minLength": 2,
            "maxLength": 100
          },
          "description": "Topics with consistently high performance"
        },
        "weaknesses": {
          "type": "array",
          "maxItems": 20,
          "items": {
            "type": "string",
            "minLength": 2,
            "maxLength": 100
          },
          "description": "Topics needing reinforcement"
        },
        "recommended_difficulty": {
          "$ref": "#/$defs/difficulty_level",
          "readOnly": true,
          "description": "Adaptive difficulty based on recent performance"
        },
        "performance_trend": {
          "type": "string",
          "enum": ["declining", "stable", "improving"],
          "readOnly": true,
          "description": "Recent performance trajectory"
        },
        "assessment_history": {
          "type": "array",
          "maxItems": 1000,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["module_id", "timestamp", "score", "difficulty"],
            "properties": {
              "module_id": {
                "$ref": "#/$defs/module_id"
              },
              "timestamp": {
                "$ref": "#/$defs/iso_datetime"
              },
              "score": {
                "$ref": "#/$defs/percentage"
              },
              "difficulty": {
                "$ref": "#/$defs/difficulty_level"
              },
              "time_taken_minutes": {
                "type": "integer",
                "minimum": 0
              },
              "hints_used": {
                "type": "integer",
                "minimum": 0
              },
              "quiz_session_id": {
                "type": "string",
                "pattern": "^qs-[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$",
                "description": "Optional reference to quiz session (Phase 4 integration)"
              },
              "num_questions": {
                "type": "integer",
                "minimum": 1,
                "description": "Number of questions in the assessment"
              },
              "passed": {
                "type": "boolean",
                "description": "Whether the learner passed the assessment"
              }
            }
          },
          "description": "Complete assessment history"
        }
      }
    }
  }
}
